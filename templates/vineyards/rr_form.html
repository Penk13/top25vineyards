{% extends 'base.html' %} {% load static %} {% load crispy_forms_tags %}

<!-- Meta Keywords -->
{% block keywords %} <meta name="keywords" content="{{ vineyard.meta_keywords }}" />
{% endblock keywords %}

<!-- Title -->
{% block title %} {{ vineyard.name }} {% endblock title %}

<!-- Nadbar Logo -->
{% block navlogo %} {% if vineyard.region.logo_on_navbar %}
<a class="navbar-brand px-0 mx-0" href="{% url 'vineyards:region' vineyard.region.slug %}">
  <img src="{{ vineyard.region.logo_on_navbar.url }}" />
</a>
{% else %}
<a class="navbar-brand" href="{{ vineyard.get_absolute_url }}">
  <img src="{% static 'img/navbrandtop25.png'%}" />
</a>
{% endif %} {% endblock navlogo %}

<!-- Slick Slider Carousel -->
{% block topcarousel %}
<section class="vineyard-detail mb-5">
  {% if vineyard.top_slider %}
  <div class="slick-carousel">
    {% for image in yard_images %}
    <img src="{{ image.image.url }}" />
    {% endfor %}
  </div>
  {% endif %}
</section>
{% endblock topcarousel %}

<!-- Vineyard Detail -->
{% block content %}
<div class="row d-flex p-3" style="border: 1px solid rgba(0, 0, 0, 0.1)">
  <h1 class="fw-bold">{{ vineyard.name }}</h1>
  <h5><i class="bi bi-geo-alt-fill"></i> {{ vineyard.wine_rg }}</h5>
  {% if vineyard.cover_slider and yard_cover_images %}
  <div class="slick-carousel-yard-cover my-3">
    {% for image in yard_cover_images %}
    <img src="{{ image.image.url }}" />
    {% endfor %}
  </div>
  {% else %}
  <img src="{{ vineyard.cover.url }}" alt="" class="img-fluid py-3" />
  {% endif %}

  <!-- Review and Rating Form -->
  <h5 class="my-3">
    <strong>Your rating and review are important to help others. Thank you!</strong>
  </h5>
  <form method="POST" id="rr_form">
    {% csrf_token %}
    <div class="form-group row my-3">
      <label for="recommendedRange" class="col-4 form-label">Would you recommend to a friend?</label
      >1
      <div class="col-7">
        <input
          type="range"
          class="form-range"
          min="1"
          max="20"
          name="recommended"
          value="{{form.recommended.value}}"
          id="recommendedRange"
          onchange="liveCalculation()"
        />
      </div>
      20
      <p class="text-danger">{{ form.recommended.errors.as_text }}</p>
    </div>
    <div class="form-group row my-3">
      <label for="valueRange" class="col-4 form-label">Value:</label>
      1
      <div class="col-7">
        <input
          type="range"
          class="form-range"
          min="1"
          max="20"
          name="value"
          value="{{form.value.value}}"
          id="valueRange"
          onchange="liveCalculation()"
        />
      </div>
      20
      <p class="text-danger">{{ form.value.errors.as_text }}</p>
    </div>
    <div class="form-group row my-3">
      <label for="serviceRange" class="col-4 form-label">Service:</label>
      1
      <div class="col-7">
        <input
          type="range"
          class="form-range"
          min="1"
          max="20"
          name="service"
          value="{{form.service.value}}"
          id="serviceRange"
          onchange="liveCalculation()"
        />
      </div>
      20
      <p class="text-danger">{{ form.service.errors.as_text }}</p>
    </div>
    <div class="form-group row my-3">
      <label for="cleanlinessRange" class="col-4 form-label">Cleanliness:</label>
      1
      <div class="col-7">
        <input
          type="range"
          class="form-range"
          min="1"
          max="20"
          name="cleanliness"
          value="{{form.cleanliness.value}}"
          id="cleanlinessRange"
          onchange="liveCalculation()"
        />
      </div>
      20
      <p class="text-danger">{{ form.cleanliness.errors.as_text }}</p>
    </div>
    <div class="form-group row my-3">
      <label for="locationRange" class="col-4 form-label">Location:</label>
      1
      <div class="col-7">
        <input
          type="range"
          class="form-range"
          min="1"
          max="20"
          name="location"
          value="{{form.location.value}}"
          id="locationRange"
          onchange="liveCalculation()"
        />
      </div>
      20
      <p class="text-danger">{{ form.location.errors.as_text }}</p>
    </div>
    <div class="form-group row my-3">
      <label for="sustainabilityRange" class="col-4 form-label">Sustainability:</label>
      1
      <div class="col-7">
        <input
          type="range"
          class="form-range"
          min="1"
          max="20"
          name="sustainability"
          value="{{form.sustainability.value}}"
          id="sustainabilityRange"
          onchange="liveCalculation()"
        />
      </div>
      20
      <p class="text-danger">{{ form.sustainability.errors.as_text }}</p>
    </div>
    <div class="mt-3 mb-5" style="font-size: 20px">
      <p>
        <strong> Total Rating </strong><span class="badge bg-primary ms-2" id="totalRating">-</span>
      </p>
    </div>
    <div class="my-3">
      <label>Title of Your Review:</label><br />
      <input class="form-control" name="title" id="titleValue" value="{{form.title.value}}" />
      <p class="text-danger">{{ form.title.errors.as_text }}</p>
    </div>
    <div class="my-3">
      <label>Your Review:</label><br />
      <textarea class="form-control" name="review" cols="40" rows="5" id="reviewValue">
{{form.review.value}}</textarea
      >
      <p class="text-danger">{{ form.review.errors.as_text }}</p>
    </div>
    <div class="form-check my-3">
      <input class="form-check-input" type="checkbox" id="beforeSubmit" required />
      <label class="form-check-label" for="beforeSubmit">
        I certify that this review and rating are based on my assessment and is my genuine opinion
        of this company or business. I have no personal or business relationship with this
        establishment, and have not been offered any incentive or payment originating from this
        establishment to write this review.
      </label>
    </div>
  </form>
  <div class="text-center row justify-content-evenly">
    <input type="submit" value="SUBMIT" class="btn btn-dark col-5" form="rr_form" />
    <!-- Button trigger Modal Preview -->
    <button
      type="button"
      class="btn btn-dark col-5"
      data-bs-toggle="modal"
      data-bs-target="#preview"
      onclick="preview()"
    >
      Preview your rating and review
    </button>
    <!-- Modal Preview -->
    <div
      class="modal fade"
      id="preview"
      tabindex="-1"
      aria-labelledby="previewLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="previewLabel">Preview</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body row">
            <div class="col-3">
              <img src="{{ request.user.profile.profile_pic.url }}" alt="" class="w-100" />
              <p>{{ request.user.username }}</p>
            </div>
            <div class="col-9 text-start" style="word-wrap: break-word">
              <h5 class="d-flex">
                <strong><span id="titlePreview"></span></strong>
                <span class="ms-auto" id="totalRatingPreview"></span>
              </h5>
              <p id="reviewPreview">{{ form.review.value }}</p>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <input type="submit" value="SUBMIT" class="btn btn-dark" form="rr_form" />
          </div>
        </div>
      </div>
    </div>
  </div>
  <p class="p-3 mt-5">
    Please note by submitting your review and rating you agree to the following:
    <br /><br />
    By submitting a review and rating you grant this website and its affiliates the right to use,
    control, share, reproduce, translate, distribute, manage, publicly display and remove your
    review and rating You are fully responsible for the content of your review and of your rating.
    Once you submit your review and rating, you transfer ownership and control to us and it is
    publicly accessible. We may also share your review with our partners, members or listed
    businesses in order that they can address any issues raised in your review or through your
    rating but we will never share your personal details. We are not responsible for the business or
    entity reviewed deducing your identity from the content of your review and rating and contacting
    you direct. You accept our review and rating terms of use and privacy policy as they apply to
    your review and rating. We reserve the right to reject reviews and ratings that do not meet our
    guidelines, in particular we can't publish your review and rating if it includes, but not
    limited to: specific rates or prices, personal insults or profanity, any personal details or any
    personally identifiable information, commercial website addresses or phone numbers.
  </p>
</div>
{% endblock content %}

<!-- Breadcrumb -->
{% block breadcrumb %}
<nav style="--bs-breadcrumb-divider: '>'" aria-label="breadcrumb">
  <ol class="breadcrumb" style="font-size: 13px">
    <li class="breadcrumb-item">
      <a href="{% url 'pages_app:mainpage' %}" class="text-dark" style="text-decoration: none"
        ><i class="bi bi-house-fill"></i> Home</a
      >
    </li>
    <li class="breadcrumb-item" aria-current="page">
      <a href="{% url 'pages_app:mainpage' %}" class="text-dark" style="text-decoration: none"
        >Regions</a
      >
    </li>
    {% if vineyard.region.region_parent %}
    <li class="breadcrumb-item" aria-current="page">
      <a
        href="{% url 'vineyards:region' vineyard.region.region_parent.slug %}"
        class="text-dark"
        style="text-decoration: none"
        >{{ vineyard.region.region_parent.name }}</a
      >
    </li>
    {% endif %}
    <li class="breadcrumb-item" aria-current="page">
      <a
        href="{% url 'vineyards:region' vineyard.region.slug %}"
        class="text-dark"
        style="text-decoration: none"
        >{{ vineyard.region.name }}</a
      >
    </li>
    <li class="breadcrumb-item active" aria-current="page">{{ vineyard.name }}</li>
  </ol>
</nav>
{% endblock breadcrumb %}

<!-- Recent Reviews -->
{% block recent_reviews %}{% if recent_reviews %}
<div class="row p-3 text-center mt-lg-0 mt-4" style="border: 1px solid rgba(0, 0, 0, 0.1)">
  <h6 class="fw-bold mb-4">Recent reviews of {{ vineyard.name }}</h6>
  {% for review in recent_reviews %}
  <div class="text-start">
    <img src="{{ review.user.profile.profile_pic.url }}" style="width: 30px" />
    <strong>{{ review.user.username }}</strong>
    <h5>{{ review.title }}</h5>
    <details style="word-wrap: break-word">
      <summary>Read more...</summary>
      <p>{{ review.review }}</p>
    </details>
    <br />
  </div>
  {% endfor %}
</div>
{% endif %}{% endblock recent_reviews %}

<!-- Sidebar -->
{% block sidebar %} {% if vineyard.sidebar %}
<div class="row p-3 text-center mt-4" style="border: 1px solid rgba(0, 0, 0, 0.1)">
  <div class="text-start">{{ vineyard.sidebar|safe }}</div>
</div>
{% endif %} {% endblock sidebar %}

<!-- Ad Manager -->
{% block admanager %} {% if vineyard.ad_manager %}
<div class="row p-3 text-center mt-4" style="border: 1px solid rgba(0, 0, 0, 0.1)">
  <div class="text-start">{{ vineyard.ad_manager|safe }}</div>
</div>
{% endif %} {% endblock admanager %}
