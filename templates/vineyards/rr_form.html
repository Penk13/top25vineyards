{% extends 'base.html' %} {% load static %} {% load crispy_forms_tags %}

<!-- Meta Keywords -->
{% block keywords %} <meta name="keywords" content="{{ vineyard.meta_keywords }}" />
{% endblock keywords %}

<!-- Title -->
{% block title %} {{ vineyard.name }} {% endblock title %}

<!-- Nadbar Logo -->
{% block navlogo %} {% if vineyard.region.logo_on_navbar %}
<a class="navbar-brand px-0 mx-0" href="{{vineyard.region.get_absolute_url}}">
  <img src="{{ vineyard.region.logo_on_navbar.url }}" />
</a>
{% else %}
<a class="navbar-brand" href="{{ vineyard.get_absolute_url }}">
  <img src="{% static 'img/navbrandtop25.png'%}" />
</a>
{% endif %} {% endblock navlogo %}

<!-- Slick Slider Carousel -->
{% block topcarousel %}
<section class="vineyard-detail mb-5">
  {% if vineyard.top_slider %}
  <div class="slick-carousel">
    {% for image in yard_images %}
    <img src="{{ image.image.url }}" />
    {% endfor %}
  </div>
  {% endif %}
</section>
{% endblock topcarousel %}

<!-- Vineyard Detail -->
{% block content %}
<div class="row d-flex p-3" style="border: 1px solid rgba(0, 0, 0, 0.1)">
  <h1 class="fw-bold">{{ vineyard.name }}</h1>
  <h5><i class="bi bi-geo-alt-fill"></i> {{ vineyard.wine_rg }}</h5>
  {% if vineyard.cover_slider and yard_cover_images %}
  <div class="slick-carousel-yard-cover my-3">
    {% for image in yard_cover_images %}
    <img src="{{ image.image.url }}" />
    {% endfor %}
  </div>
  {% else %}
  <img src="{{ vineyard.cover.url }}" alt="" class="img-fluid py-3" />
  {% endif %}

  <!-- Review and Rating Form -->
  <h5 class="my-3">
    <strong>Your rating and review are important. Thank you!</strong>
  </h5>
  <form method="POST" id="rr_form">
    {% csrf_token %}
    <div class="row">
      <div class="col-8">
        <label for="recommendedRange" class="form-label"
          >Would you recommend a vineyard visit to a friend?</label
        >
        <div class="row mx-0">
          1
          <div class="col-10">
            <input
              type="range"
              class="form-range"
              min="1"
              max="20"
              name="recommended"
              value="{{form.recommended.value}}"
              id="recommendedRange"
              onchange="liveCalculation()"
            />
          </div>
          20
        </div>
        <p class="text-danger">{{ form.recommended.errors.as_text }}</p>
        <label for="valueRange" class="form-label">Vineyard Tours:</label>
        <div class="row mx-0">
          1
          <div class="col-10">
            <input
              type="range"
              class="form-range"
              min="1"
              max="20"
              name="value"
              value="{{form.value.value}}"
              id="valueRange"
              onchange="liveCalculation()"
            />
          </div>
          20
        </div>
        <p class="text-danger">{{ form.value.errors.as_text }}</p>
        <label for="serviceRange" class="form-label">Tasting Experience:</label>
        <div class="row mx-0">
          1
          <div class="col-10">
            <input
              type="range"
              class="form-range"
              min="1"
              max="20"
              name="service"
              value="{{form.service.value}}"
              id="serviceRange"
              onchange="liveCalculation()"
            />
          </div>
          20
        </div>
        <p class="text-danger">{{ form.service.errors.as_text }}</p>
        <label for="cleanlinessRange" class="form-label">Wine Sales:</label>
        <div class="row mx-0">
          1
          <div class="col-10">
            <input
              type="range"
              class="form-range"
              min="1"
              max="20"
              name="cleanliness"
              value="{{form.cleanliness.value}}"
              id="cleanlinessRange"
              onchange="liveCalculation()"
            />
          </div>
          20
        </div>
        <p class="text-danger">{{ form.cleanliness.errors.as_text }}</p>
        <label for="locationRange" class="form-label">Sustainability Efforts:</label>
        <div class="row mx-0">
          1
          <div class="col-10">
            <input
              type="range"
              class="form-range"
              min="1"
              max="20"
              name="location"
              value="{{form.location.value}}"
              id="locationRange"
              onchange="liveCalculation()"
            />
          </div>
          20
        </div>
        <p class="text-danger">{{ form.location.errors.as_text }}</p>
        <label for="sustainabilityRange" class="form-label">Overall Experience:</label>
        <div class="row mx-0">
          1
          <div class="col-10">
            <input
              type="range"
              class="form-range"
              min="1"
              max="20"
              name="sustainability"
              value="{{form.sustainability.value}}"
              id="sustainabilityRange"
              onchange="liveCalculation()"
            />
          </div>
          20
        </div>
        <p class="text-danger">{{ form.sustainability.errors.as_text }}</p>
      </div>
      <div class="col-4 col-md-3 p-0 my-auto">
        <div
          class="text-center fw-bold border border-secondary rounded-3 mx-auto"
          style="max-width: fit-content"
          id="your-rating"
        >
          <p class="m-3 mb-0" style="font-size: 18px">Your Rating</p>
          <p class="m-2 mt-0" id="totalRating" style="color: orangered; font-size: 7vmin">10.00</p>
          <p class="m-0 py-1" style="background-color: #20669b; color: white; font-size: 18px">
            VINEYARD
          </p>
        </div>
        <div class="mx-auto" id="text-below-your-rating">
          <p class="my-2" style="font-size: 12px">
            Your personal overall rating on a scale from 1 to 20 where 20 is the best rating
          </p>
        </div>
      </div>
    </div>
    <div class="my-3">
      <label>Title of Your Review:</label><br />
      <input class="form-control" name="title" id="titleValue" placeholder="Title your review here" />
      <p class="text-danger">{{ form.title.errors.as_text }}</p>
    </div>
    <div class="my-3">
      <label>Your Review:</label><br />
      <textarea class="form-control" name="review" cols="40" rows="5" id="reviewValue" placeholder="Write your review here"></textarea>
      <p class="text-danger">{{ form.review.errors.as_text }}</p>
    </div>
    <div class="form-check my-3">
      <input class="form-check-input" type="checkbox" id="beforeSubmit" required />
      <label class="form-check-label" for="beforeSubmit">
        I certify that this review and rating are based on my assessment and is my genuine opinion
        of this company or business. I have no personal or business relationship with this
        establishment, and have not been offered any incentive or payment originating from this
        establishment to write this review.
      </label>
    </div>
  </form>
  <div class="text-center row justify-content-evenly">
    <input type="submit" value="SUBMIT" class="btn btn-dark col-5" form="rr_form" />
    <!-- Button trigger Modal Preview -->
    <button
      type="button"
      class="btn btn-dark col-5"
      data-bs-toggle="modal"
      data-bs-target="#preview"
      onclick="preview()"
    >
      Preview your rating and review
    </button>
    <!-- Modal Preview -->
    <div
      class="modal fade"
      id="preview"
      tabindex="-1"
      aria-labelledby="previewLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="previewLabel">Preview</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body row">
            <div class="col-3">
              <img src="{{ request.user.profile.profile_pic.url }}" alt="" class="w-100" />
              <p>{{ request.user.username }}</p>
            </div>
            <div class="col-9 text-start" style="word-wrap: break-word">
              <h5 class="d-flex">
                <strong><span id="titlePreview"></span></strong>
                <span class="ms-auto" id="totalRatingPreview"></span>
              </h5>
              <p id="reviewPreview">{{ form.review.value }}</p>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <input type="submit" value="SUBMIT" class="btn btn-dark" form="rr_form" />
          </div>
        </div>
      </div>
    </div>
  </div>
  <p class="p-3 mt-5">
    Please note by submitting your review and rating you agree to the following:
    <br /><br />
    By submitting a review and rating you grant this website and its affiliates the right to use,
    control, share, reproduce, translate, distribute, manage, publicly display and remove your
    review and rating You are fully responsible for the content of your review and of your rating.
    Once you submit your review and rating, you transfer ownership and control to us and it is
    publicly accessible. We may also share your review with our partners, members or listed
    businesses in order that they can address any issues raised in your review or through your
    rating but we will never share your personal details. We are not responsible for the business or
    entity reviewed deducing your identity from the content of your review and rating and contacting
    you direct. You accept our review and rating terms of use and privacy policy as they apply to
    your review and rating. We reserve the right to reject reviews and ratings that do not meet our
    guidelines, in particular we can't publish your review and rating if it includes, but not
    limited to: specific rates or prices, personal insults or profanity, any personal details or any
    personally identifiable information, commercial website addresses or phone numbers.
  </p>
</div>
{% endblock content %}

<!-- Breadcrumb -->
{% block breadcrumb %}
<nav style="--bs-breadcrumb-divider: '>'" aria-label="breadcrumb">
  <ol class="breadcrumb" style="font-size: 13px">
    <li class="breadcrumb-item">
      <a href="{% url 'pages_app:mainpage' %}" class="text-dark" style="text-decoration: none"
        ><i class="bi bi-house-fill"></i> Home</a
      >
    </li>
    <li class="breadcrumb-item" aria-current="page">
      <a href="{% url 'pages_app:mainpage' %}" class="text-dark" style="text-decoration: none"
        >Regions</a
      >
    </li>
    {% if vineyard.region.region_parent %}
    <li class="breadcrumb-item" aria-current="page">
      <a
        href="{{vineyard.region.region_parent.get_absolute_url}}"
        class="text-dark"
        style="text-decoration: none"
        >{{ vineyard.region.region_parent.name }}</a
      >
    </li>
    {% endif %}
    <li class="breadcrumb-item" aria-current="page">
      <a href="{{vineyard.get_absolute_url}}" class="text-dark" style="text-decoration: none"
        >{{ vineyard.region.name }}</a
      >
    </li>
    <li class="breadcrumb-item active" aria-current="page">{{ vineyard.name }}</li>
  </ol>
</nav>
{% endblock breadcrumb %}

<!-- Recent Reviews -->
{% block recent_reviews %}{% if recent_reviews %}
<div class="row p-3 mt-lg-0 mt-4" style="border: 1px solid rgba(0, 0, 0, 0.1)">
  <h6 class="row fw-bold mb-3">
    <div class="col-3">
      <img src="{% static 'img/reviews_sidebar_icon.png'%}" style="height: 36px" />
    </div>
    <div class="col-9 px-0">Recent reviews of {{ vineyard.name }}</div>
  </h6>
  <hr />
  {% for review in recent_reviews %}
  <div class="text-start mb-3" style="font-size: 14px">
    <div class="my-3">
      <img
        src="{{ review.user.profile.profile_pic.url }}"
        style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover"
      />
      <span style="font-size: 18px">{{ review.title }}</span>
    </div>
    {% if review.review|wordcount > 20 %}
    <div class="half-content-sidebar" id="half-{{ review.pk }}-sidebar" style="display: block">
      {{ review.review|safe|truncatewords:20|slice:"-2" }}
      <a
        id="{{ review.pk }}"
        class="fw-bold text-dark"
        onclick="sidebarMoreLess(this)"
        style="text-decoration: none; cursor: pointer"
        ><i class="bi bi-caret-right-fill"></i>more...</a
      >
    </div>
    <div class="full-content-sidebar" id="full-{{ review.pk }}-sidebar" style="display: none">
      {{ review.review|safe }}
      <a
        id="{{ review.pk }}"
        class="fw-bold text-dark"
        onclick="sidebarMoreLess(this)"
        style="text-decoration: none; cursor: pointer"
        ><i class="bi bi-caret-left-fill"></i>less</a
      >
    </div>
    {% else %}
    <p>{{ r.review|safe|linebreaks }}</p>
    {% endif %}
  </div>
  {% endfor %}
</div>
{% endif %}{% endblock recent_reviews %}

<!-- Sidebar -->
{% block sidebar %} {% if vineyard.sidebar %}
<div class="row p-3 text-center mt-4" style="border: 1px solid rgba(0, 0, 0, 0.1)">
  <div class="text-start">{{ vineyard.sidebar|safe }}</div>
</div>
{% elif vineyard.sidebar == "" and default_sidebar != "" %}
<div class="row p-3 text-center mt-4" style="border: 1px solid rgba(0, 0, 0, 0.1)">
  <div class="text-start">{{ default_sidebar|safe }}</div>
</div>
{% endif %} {% endblock sidebar %}

<!-- Ad Manager -->
{% block admanager %} {% if vineyard.ad_manager %}
<div class="row p-3 text-center mt-4" style="border: 1px solid rgba(0, 0, 0, 0.1)">
  <div class="text-start">{{ vineyard.ad_manager|safe }}</div>
</div>
{% elif vineyard.ad_manager == "" and default_ad_manager != "" %}
<div class="row p-3 text-center mt-4" style="border: 1px solid rgba(0, 0, 0, 0.1)">
  <div class="text-start">{{ default_ad_manager|safe }}</div>
</div>
{% endif %} {% endblock admanager %}
